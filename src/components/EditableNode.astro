---
import EditableNode from "./EditableNode.astro";

const { node } = Astro.props;

// Helper for labels
const getTypeLabel = (type) => {
    switch (type) {
        case "title":
            return "Τίτλος";
        case "chapter":
            return "Κεφάλαιο";
        case "section":
            return "Τμήμα";
        case "article":
            return "Άρθρο";
        default:
            return "Στοιχείο";
    }
};

const label = getTypeLabel(node.type);
const isArticle = node.type === "article";
---

<div class="item node-item" data-type={node.type} data-file={node.file || ""}>
    <div class="content">
        {/* Main Row - Plain & Simple */}
        <div
            class="ui segment"
            style="padding: 0.5em; margin: 0.2em 0; display: flex; align-items: center; gap: 10px; background: #fff; border: 1px solid rgba(34,36,38,.15); box-shadow: none;"
        >
            {/* 1. Drag Handle (6 Dots) */}
            <i
                class="grip vertical icon drag-handle"
                style="cursor: move; color: #555; margin: 0; opacity: 0.7;"></i>

            {/* 2. Type Label (Plain Grey) */}
            <div
                class="ui label tiny basic"
                style="color: #666; border-color: #ddd;"
            >
                {label}
            </div>

            {/* 3. Number Input */}
            <div class="ui transparent input" style="width: 40px;">
                <input
                    type="number"
                    class="node-number"
                    value={node.number}
                    disabled
                    style="text-align: center; font-family: monospace;"
                />
            </div>

            {/* 4. Name Input */}
            <div class="ui transparent input" style="flex-grow: 1;">
                <input
                    type="text"
                    class="node-name"
                    value={node.name}
                    disabled
                    style={!isArticle ? "font-weight: 700;" : ""}
                />
            </div>

            {/* 5. Article Edit Trigger */}
            {
                isArticle && (
                    <button
                        class="ui icon button basic tiny edit-content-btn"
                        data-file={node.file}
                        title="Επεξεργασία Κειμένου"
                        style="margin: 0; box-shadow: none !important;"
                    >
                        <i class="pencil alternate icon" style="color: #666;" />
                    </button>
                )
            }
        </div>

        {/* Recursive Children - Minimal Indentation */}
        <div
            class="ui list nested-sortable"
            style="margin-left: 15px; border-left: 2px solid #e0e0e0; padding-left: 5px; min-height: 5px;"
        >
            {
                node.children &&
                    node.children.map((child, i) => (
                        <EditableNode node={child} index={i} />
                    ))
            }
        </div>
    </div>
</div>
